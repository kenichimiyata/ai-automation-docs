<!DOCTYPE html>
<html lang="ja">
<head>
  <base target="_top">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BPMN Designer - Human + AI Collaboration</title>
  <script src="https://unpkg.com/gojs/release/go.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+JP:wght@400;500;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0f1718;
      --panel: #f7f4eb;
      --ink: #162022;
      --muted: #5a676d;
      --line: #d9d5c9;
      --accent: #db5f2a;
      --accent2: #1fa692;
      --human: #2c7fb8;
      --ai: #a13db6;
      --warn: #b45309;
      --ok: #15803d;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "IBM Plex Sans JP", sans-serif;
      color: var(--ink);
      background:
        radial-gradient(circle at 8% 8%, rgba(31, 166, 146, 0.25) 0%, rgba(31, 166, 146, 0) 48%),
        radial-gradient(circle at 90% 0%, rgba(219, 95, 42, 0.24) 0%, rgba(219, 95, 42, 0) 48%),
        linear-gradient(145deg, #0b1314 0%, #132022 55%, #1b2a2c 100%);
      padding: 18px;
    }

    .page {
      max-width: 1480px;
      margin: 0 auto;
    }

    .head {
      color: #f4f7f5;
      margin-bottom: 14px;
    }

    .head h1 {
      margin: 0;
      font-family: "Space Grotesk", sans-serif;
      font-size: 30px;
      letter-spacing: 0.3px;
    }

    .head p {
      margin: 8px 0 0;
      color: #ccdbd7;
      font-size: 14px;
    }

    .layout {
      display: grid;
      grid-template-columns: 390px 1fr 320px;
      gap: 14px;
    }

    .panel {
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(247, 244, 235, 0.96);
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 16px 40px rgba(2, 10, 11, 0.25);
    }

    .panel-head {
      padding: 12px 14px;
      border-bottom: 1px solid var(--line);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0));
    }

    .panel-title {
      margin: 0;
      font-family: "Space Grotesk", sans-serif;
      font-size: 15px;
    }

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 10px 12px;
      border-bottom: 1px solid var(--line);
      background: #fffdf8;
    }

    button,
    label.file-btn {
      font-family: "IBM Plex Sans JP", sans-serif;
      border: 0;
      border-radius: 9px;
      font-size: 13px;
      font-weight: 600;
      padding: 8px 11px;
      cursor: pointer;
    }

    .btn-main { background: var(--accent2); color: #fff; }
    .btn-sub { background: #e9e4d8; color: #1b2223; }
    .btn-main:hover { filter: brightness(0.96); }
    .btn-sub:hover { background: #ddd7ca; }

    input[type="file"] { display: none; }

    #status {
      font-size: 12px;
      color: var(--muted);
      padding: 10px 12px;
      border-bottom: 1px solid var(--line);
      background: #fffaf0;
    }

    #status.ok { color: var(--ok); }
    #status.warn { color: var(--warn); }

    #paletteDiv {
      width: 100%;
      height: 220px;
      border-bottom: 1px solid var(--line);
      background: #fefcf6;
    }

    textarea {
      width: 100%;
      min-height: 260px;
      border: 0;
      border-top: 1px solid var(--line);
      border-bottom: 1px solid var(--line);
      resize: vertical;
      padding: 12px;
      font: 12px/1.4 Consolas, Menlo, monospace;
      background: #fff;
      color: #1f2628;
    }

    .hint {
      padding: 10px 12px;
      font-size: 12px;
      color: #4f595e;
      background: #fff;
    }

    .canvas-wrap {
      display: flex;
      flex-direction: column;
      min-height: 760px;
    }

    #diagramDiv {
      width: 100%;
      height: 680px;
      border-bottom: 1px solid var(--line);
      background: linear-gradient(180deg, #f8f8f3 0%, #ecece5 100%);
    }

    .stats {
      padding: 10px 12px;
      font-size: 12px;
      color: #4f5e65;
      background: #fffef9;
    }

    .field {
      padding: 10px 12px;
      border-bottom: 1px solid var(--line);
      background: #fff;
    }

    .field label {
      display: block;
      font-size: 12px;
      margin-bottom: 4px;
      color: #4d5a60;
      font-weight: 600;
    }

    .field input,
    .field select,
    .field textarea {
      width: 100%;
      border: 1px solid #cfd5d6;
      border-radius: 8px;
      padding: 8px;
      font-size: 13px;
      background: #fff;
      color: #162022;
      min-height: auto;
      resize: vertical;
    }

    #detailJson {
      margin: 0;
      padding: 12px;
      background: #11161b;
      color: #dbe4e8;
      font-size: 12px;
      line-height: 1.35;
      max-height: 220px;
      overflow: auto;
      border-top: 1px solid #2c3740;
    }

    @media (max-width: 1280px) {
      .layout {
        grid-template-columns: 1fr;
      }

      #diagramDiv {
        height: 560px;
      }
    }
  </style>
</head>
<body>
  <main class="page">
    <header class="head">
      <h1>BPMN Designer: Human + AI</h1>
      <p>人間とAIの共存プロセスを BPMN で設計し、n8n workflow JSON も流し込める統合デザイナー。</p>
    </header>

    <section class="layout">
      <aside class="panel">
        <div class="panel-head">
          <h2 class="panel-title">Tools + n8n Input</h2>
        </div>
        <div class="toolbar">
          <button id="newBtn" class="btn-sub">新規BPMN</button>
          <button id="seedBtn" class="btn-main">協働テンプレート</button>
          <button id="applyN8nBtn" class="btn-main">n8nをBPMN化</button>
          <button id="exportBtn" class="btn-sub">BPMN JSON書出</button>
          <button id="exportCanonicalBtn" class="btn-sub">共通JSON書出</button>
          <button id="importCanonicalBtn" class="btn-main">共通JSON読込</button>
          <button id="exportN8nBtn" class="btn-sub">n8n JSON書出</button>
          <button id="openOfficialBtn" class="btn-sub">公式BPMN Sample</button>
          <label class="file-btn btn-sub" for="jsonFile">JSON読込</label>
          <input id="jsonFile" type="file" accept=".json,application/json" />
        </div>
        <div id="status">Ready.</div>
        <div class="panel-head">
          <h3 class="panel-title">BPMN Palette</h3>
        </div>
        <div id="paletteDiv"></div>
        <div class="panel-head">
          <h3 class="panel-title">n8n JSON</h3>
        </div>
        <textarea id="n8nInput" spellcheck="false" placeholder="n8n workflow JSON を貼り付け"></textarea>
        <div class="hint">`nodes` と `connections` を含む JSON なら、AI/Human Lane に自動配置して BPMN 化します。</div>
      </aside>

      <section class="panel canvas-wrap">
        <div class="panel-head">
          <h2 class="panel-title">BPMN Canvas</h2>
          <span id="stats" style="font-size:12px;color:#536167;">nodes: 0 / links: 0</span>
        </div>
        <div id="diagramDiv"></div>
        <div class="stats">Lane color: Human = blue, AI = violet. Drag-and-drop でタスク再配置可能。</div>
      </section>

      <aside class="panel">
        <div class="panel-head">
          <h2 class="panel-title">Node Inspector</h2>
        </div>
        <div class="field">
          <label for="nodeText">Text</label>
          <input id="nodeText" type="text" />
        </div>
        <div class="field">
          <label for="nodeRole">Role</label>
          <select id="nodeRole">
            <option value="Human">Human</option>
            <option value="AI">AI</option>
            <option value="Shared">Shared</option>
          </select>
        </div>
        <div class="field">
          <label for="nodeNote">Note</label>
          <textarea id="nodeNote" rows="6" placeholder="運用メモ / 会話メモ"></textarea>
        </div>
        <div class="toolbar" style="border-top:1px solid var(--line);">
          <button id="saveNodeBtn" class="btn-main">ノード更新</button>
        </div>
        <pre id="detailJson">{}</pre>
      </aside>
    </section>
  </main>

  <script>
    const $ = go.GraphObject.make;

    const n8nInput = document.getElementById("n8nInput");
    const statusEl = document.getElementById("status");
    const statsEl = document.getElementById("stats");
    const detailJson = document.getElementById("detailJson");

    const nodeText = document.getElementById("nodeText");
    const nodeRole = document.getElementById("nodeRole");
    const nodeNote = document.getElementById("nodeNote");

    const HUMAN_Y = 170;
    const AI_Y = 460;

    function setStatus(msg, mode = "") {
      statusEl.textContent = msg;
      statusEl.className = mode ? mode : "";
      if (mode) statusEl.classList.add(mode);
    }

    function roleColor(role) {
      if (role === "AI") return "#a13db6";
      if (role === "Human") return "#2c7fb8";
      return "#6b7280";
    }

    function laneY(role) {
      return role === "AI" ? AI_Y : HUMAN_Y;
    }

    function nodeShapeByCategory(cat) {
      if (cat === "Start" || cat === "End") return "Circle";
      if (cat === "Gateway") return "Diamond";
      return "RoundedRectangle";
    }

    const diagram = $(go.Diagram, "diagramDiv", {
      "undoManager.isEnabled": true,
      grid: $(go.Panel, "Grid",
        $(go.Shape, "LineH", { stroke: "#e4e3dc", strokeWidth: 0.6 }),
        $(go.Shape, "LineV", { stroke: "#e4e3dc", strokeWidth: 0.6 })
      ),
      "draggingTool.isGridSnapEnabled": true,
      "linkingTool.direction": go.LinkingDirection.ForwardsOnly,
      "toolManager.mouseWheelBehavior": go.ToolManager.WheelZoom,
      initialContentAlignment: go.Spot.TopLeft
    });

    // Lane backgrounds
    diagram.add(
      $(go.Part, "Position",
        { layerName: "Background", selectable: false, pickable: false, position: new go.Point(0, 70) },
        $(go.Shape, "Rectangle", { fill: "rgba(44,127,184,0.08)", stroke: "#2c7fb8", strokeDashArray: [6, 4], width: 2600, height: 210 }),
        $(go.TextBlock, "Human Lane", { position: new go.Point(12, 12), font: "bold 15px 'Space Grotesk', sans-serif", stroke: "#2c7fb8" })
      )
    );

    diagram.add(
      $(go.Part, "Position",
        { layerName: "Background", selectable: false, pickable: false, position: new go.Point(0, 360) },
        $(go.Shape, "Rectangle", { fill: "rgba(161,61,182,0.08)", stroke: "#a13db6", strokeDashArray: [6, 4], width: 2600, height: 210 }),
        $(go.TextBlock, "AI Lane", { position: new go.Point(12, 12), font: "bold 15px 'Space Grotesk', sans-serif", stroke: "#a13db6" })
      )
    );

    diagram.nodeTemplate =
      $(go.Node, "Auto",
        {
          selectionAdorned: true,
          locationSpot: go.Spot.Center,
          mouseDragEnter: (_, node) => node.findObject("SHAPE").strokeWidth = 2.4,
          mouseDragLeave: (_, node) => node.findObject("SHAPE").strokeWidth = 1.3
        },
        new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
        $(go.Shape,
          {
            name: "SHAPE",
            figure: "RoundedRectangle",
            fill: "#fffefb",
            stroke: "#4a5960",
            strokeWidth: 1.3,
            minSize: new go.Size(120, 56)
          },
          new go.Binding("figure", "category", nodeShapeByCategory),
          new go.Binding("stroke", "role", roleColor)
        ),
        $(go.Panel, "Vertical", { margin: 8 },
          $(go.TextBlock,
            {
              font: "bold 12px 'IBM Plex Sans JP', sans-serif",
              stroke: "#0f1c20",
              margin: new go.Margin(0, 4, 2, 4),
              editable: true,
              maxSize: new go.Size(200, NaN),
              wrap: go.Wrap.Fit
            },
            new go.Binding("text", "text").makeTwoWay()
          ),
          $(go.TextBlock,
            { font: "11px Consolas, monospace", stroke: "#5b666d" },
            new go.Binding("text", "meta")
          )
        )
      );

    diagram.linkTemplate =
      $(go.Link,
        { routing: go.Routing.AvoidsNodes, corner: 8, curve: go.Curve.JumpGap },
        $(go.Shape, { stroke: "#2e3f46", strokeWidth: 1.35 }),
        $(go.Shape, { toArrow: "Standard", fill: "#2e3f46", stroke: null })
      );

    const palette = $(go.Palette, "paletteDiv", {
      nodeTemplateMap: diagram.nodeTemplateMap,
      model: new go.GraphLinksModel([
        { key: "Start", text: "Start", category: "Start", role: "Human", meta: "start" },
        { key: "HumanTask", text: "Human Task", category: "Task", role: "Human", meta: "task" },
        { key: "AITask", text: "AI Task", category: "Task", role: "AI", meta: "task" },
        { key: "Gateway", text: "Decision", category: "Gateway", role: "Shared", meta: "gateway" },
        { key: "End", text: "End", category: "End", role: "Human", meta: "end" }
      ])
    });

    function modelStats() {
      const m = diagram.model;
      statsEl.textContent = `nodes: ${m.nodeDataArray.length} / links: ${m.linkDataArray.length}`;
    }

    function assignInspector(data) {
      if (!data) {
        nodeText.value = "";
        nodeRole.value = "Human";
        nodeNote.value = "";
        detailJson.textContent = "{}";
        return;
      }
      nodeText.value = data.text || "";
      nodeRole.value = data.role || "Human";
      nodeNote.value = data.note || "";
      detailJson.textContent = JSON.stringify(data, null, 2);
    }

    diagram.addDiagramListener("ChangedSelection", () => {
      const node = diagram.selection.first();
      if (!node || !node.data) {
        assignInspector(null);
        return;
      }
      assignInspector(node.data);
    });

    document.getElementById("saveNodeBtn").addEventListener("click", () => {
      const node = diagram.selection.first();
      if (!node || !node.data) {
        setStatus("先にノードを選択してください。", "warn");
        return;
      }

      diagram.startTransaction("update node");
      diagram.model.setDataProperty(node.data, "text", nodeText.value.trim() || "Task");
      diagram.model.setDataProperty(node.data, "role", nodeRole.value);
      diagram.model.setDataProperty(node.data, "note", nodeNote.value);
      diagram.model.setDataProperty(node.data, "loc", `${node.location.x} ${laneY(nodeRole.value)}`);
      diagram.commitTransaction("update node");
      assignInspector(node.data);
      setStatus("ノードを更新しました。", "ok");
    });

    function seedCollaborationModel() {
      const model = new go.GraphLinksModel(
        [
          { key: "S", category: "Start", text: "Issue Input", role: "Human", meta: "start", loc: `120 ${HUMAN_Y}` },
          { key: "H1", category: "Task", text: "Human: intent clarify", role: "Human", meta: "analysis", loc: `330 ${HUMAN_Y}` },
          { key: "A1", category: "Task", text: "AI: draft automation plan", role: "AI", meta: "planning", loc: `560 ${AI_Y}` },
          { key: "G1", category: "Gateway", text: "Agree?", role: "Shared", meta: "decision", loc: `790 ${HUMAN_Y}` },
          { key: "A2", category: "Task", text: "AI: execute workflow", role: "AI", meta: "execution", loc: `1020 ${AI_Y}` },
          { key: "H2", category: "Task", text: "Human: validate result", role: "Human", meta: "review", loc: `1240 ${HUMAN_Y}` },
          { key: "E", category: "End", text: "Knowledge saved", role: "Human", meta: "end", loc: `1460 ${HUMAN_Y}` }
        ],
        [
          { from: "S", to: "H1" },
          { from: "H1", to: "A1" },
          { from: "A1", to: "G1" },
          { from: "G1", to: "A2" },
          { from: "A2", to: "H2" },
          { from: "H2", to: "E" }
        ]
      );

      diagram.model = model;
      modelStats();
      setStatus("Human + AI 協働BPMNを作成しました。", "ok");
    }

    function mapN8nTypeToCategory(nodeType) {
      const t = String(nodeType || "");
      if (t.includes("webhook") || t.includes("trigger")) return "Start";
      if (t.includes("if") || t.includes("switch")) return "Gateway";
      return "Task";
    }

    function mapN8nTypeToRole(nodeType) {
      const t = String(nodeType || "");
      if (t.includes("manual") || t.includes("form") || t.includes("webhook")) return "Human";
      return "AI";
    }

    function convertN8nToBpmn(json) {
      const nodes = Array.isArray(json.nodes) ? json.nodes : [];
      const nodeData = [];
      const linkData = [];

      nodes.forEach((n, idx) => {
        const role = mapN8nTypeToRole(n.type);
        nodeData.push({
          key: String(n.id || n.name || `n-${idx}`),
          category: mapN8nTypeToCategory(n.type),
          text: n.name || String(n.id || `node-${idx}`),
          role,
          meta: n.type || "n8n-node",
          note: "",
          raw: n,
          loc: `${180 + idx * 220} ${laneY(role)}`
        });
      });

      const con = json.connections || {};
      Object.keys(con).forEach((from) => {
        const mains = con[from] && con[from].main;
        if (!Array.isArray(mains)) return;
        mains.forEach((g) => {
          if (!Array.isArray(g)) return;
          g.forEach((item) => {
            if (!item || !item.node) return;
            linkData.push({ from: String(from), to: String(item.node) });
          });
        });
      });

      return new go.GraphLinksModel(nodeData, linkData);
    }

    function diagramToCanonicalModel() {
      const nodes = (diagram.model.nodeDataArray || []).map((n) => {
        const p = go.Point.parse(n.loc || "0 0");
        return {
          id: String(n.key),
          label: n.text || String(n.key),
          kind: n.category || "Task",
          role: n.role || "Shared",
          note: n.note || "",
          pos: { x: Math.round(p.x), y: Math.round(p.y) },
          meta: n.meta || "",
          rawType: n.raw && n.raw.type ? n.raw.type : ""
        };
      });

      const edges = (diagram.model.linkDataArray || []).map((l, i) => ({
        id: `e-${i + 1}`,
        from: String(l.from),
        to: String(l.to),
        label: l.text || ""
      }));

      return {
        schema: "ai-bpmn-model/v1",
        metadata: {
          exportedAt: new Date().toISOString(),
          source: "bpmn-designer"
        },
        nodes,
        edges
      };
    }

    function canonicalToDiagramModel(canonical) {
      const nodes = Array.isArray(canonical.nodes) ? canonical.nodes : [];
      const edges = Array.isArray(canonical.edges) ? canonical.edges : [];

      const nodeData = nodes.map((n, idx) => {
        const x = n.pos && typeof n.pos.x === "number" ? n.pos.x : 180 + idx * 220;
        const role = n.role || "Shared";
        const y = n.pos && typeof n.pos.y === "number" ? n.pos.y : laneY(role);
        return {
          key: String(n.id || `n-${idx}`),
          category: n.kind || "Task",
          text: n.label || String(n.id || `node-${idx}`),
          role,
          meta: n.meta || "",
          note: n.note || "",
          loc: `${x} ${y}`
        };
      });

      const linkData = edges
        .filter((e) => e && e.from && e.to)
        .map((e) => ({ from: String(e.from), to: String(e.to), text: e.label || "" }));

      return new go.GraphLinksModel(nodeData, linkData);
    }

    function canonicalToN8n(canonical) {
      const nodes = Array.isArray(canonical.nodes) ? canonical.nodes : [];
      const edges = Array.isArray(canonical.edges) ? canonical.edges : [];

      const n8nNodes = nodes.map((n, idx) => {
        let mappedType = "n8n-nodes-base.code";
        if (n.kind === "Start") mappedType = "n8n-nodes-base.webhook";
        if (n.kind === "Gateway") mappedType = "n8n-nodes-base.if";
        if (n.rawType) mappedType = n.rawType;

        return {
          id: String(n.id || `node-${idx}`),
          name: n.label || String(n.id || `node-${idx}`),
          type: mappedType,
          typeVersion: 1,
          position: [
            n.pos && typeof n.pos.x === "number" ? n.pos.x : 240 + idx * 200,
            n.pos && typeof n.pos.y === "number" ? n.pos.y : 300
          ],
          parameters: {}
        };
      });

      const connections = {};
      edges.forEach((e) => {
        const from = String(e.from);
        const to = String(e.to);
        if (!connections[from]) connections[from] = { main: [[]] };
        connections[from].main[0].push({ node: to, type: "main", index: 0 });
      });

      return {
        name: "Converted from Canonical Model",
        active: false,
        nodes: n8nNodes,
        connections,
        settings: { executionOrder: "v1" },
        tags: ["converted", "canonical-model"]
      };
    }

    document.getElementById("newBtn").addEventListener("click", () => {
      diagram.model = new go.GraphLinksModel([], []);
      modelStats();
      setStatus("新規BPMNキャンバスを作成しました。", "ok");
    });

    document.getElementById("seedBtn").addEventListener("click", seedCollaborationModel);

    document.getElementById("applyN8nBtn").addEventListener("click", () => {
      try {
        const json = JSON.parse(n8nInput.value);
        diagram.model = convertN8nToBpmn(json);
        modelStats();
        setStatus("n8n JSON を BPMN へ変換しました。", "ok");
      } catch (err) {
        setStatus(`変換失敗: ${err.message}`, "warn");
      }
    });

    document.getElementById("exportBtn").addEventListener("click", () => {
      const blob = new Blob([diagram.model.toJson()], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "bpmn-human-ai-model.json";
      a.click();
      setStatus("BPMN JSON を書き出しました。", "ok");
    });

    document.getElementById("exportCanonicalBtn").addEventListener("click", () => {
      const canonical = diagramToCanonicalModel();
      const canonicalText = JSON.stringify(canonical, null, 2);
      n8nInput.value = canonicalText;

      const blob = new Blob([canonicalText], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "ai-bpmn-canonical-model.json";
      a.click();
      setStatus("共通JSONモデルを書き出しました。", "ok");
    });

    document.getElementById("importCanonicalBtn").addEventListener("click", () => {
      try {
        const parsed = JSON.parse(n8nInput.value);
        if (parsed.schema !== "ai-bpmn-model/v1") {
          setStatus("共通JSON(schema: ai-bpmn-model/v1)ではありません。", "warn");
          return;
        }
        diagram.model = canonicalToDiagramModel(parsed);
        modelStats();
        setStatus("共通JSONモデルを読み込みました。", "ok");
      } catch (err) {
        setStatus(`読込失敗: ${err.message}`, "warn");
      }
    });

    document.getElementById("exportN8nBtn").addEventListener("click", () => {
      const canonical = diagramToCanonicalModel();
      const n8n = canonicalToN8n(canonical);
      const n8nText = JSON.stringify(n8n, null, 2);
      n8nInput.value = n8nText;

      const blob = new Blob([n8nText], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "converted-to-n8n-workflow.json";
      a.click();
      setStatus("n8n JSON を書き出しました。", "ok");
    });

    document.getElementById("openOfficialBtn").addEventListener("click", () => {
      window.open("./bpmn-sample/BPMN.html", "_blank");
    });

    document.getElementById("jsonFile").addEventListener("change", (ev) => {
      const file = ev.target.files[0];
      if (!file) return;

      file.text().then((txt) => {
        n8nInput.value = txt;
        setStatus("JSONを読み込みました。n8nをBPMN化 を押してください。", "ok");
      }).catch((err) => {
        setStatus(`ファイル読込失敗: ${err.message}`, "warn");
      });
    });

    // Load sample n8n to bootstrap quickly
    fetch("./data/n8n_workflow_phprunner11.json")
      .then((r) => {
        if (!r.ok) throw new Error(`HTTP ${r.status}`);
        return r.json();
      })
      .then((data) => {
        n8nInput.value = JSON.stringify(data, null, 2);
        diagram.model = convertN8nToBpmn(data);
        modelStats();
        setStatus("初期サンプルを読み込みました。", "ok");
      })
      .catch(() => {
        seedCollaborationModel();
        setStatus("サンプル取得に失敗。協働テンプレートで開始しました。", "warn");
      });
  </script>
</body>
</html>
